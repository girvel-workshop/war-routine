#!/usr/bin/xonsh

from termcolor import colored

if $ARG1 == "launch": 
    if ![$ARG0 test].returncode != 0:
        read -p "There are failed tests. Do you want to stop the launch? [y/N] " -n 1 -r
        echo
        if $REPLY in ("Y", "y"):
            exit(1)
    print("Launching", colored($(basename $PWD)[:-1], 'red'))
    love .

if $ARG1 == "commit":
    if ![$ARG0 test].returncode != 0:
        read -p "There are failed tests. Do you want to stop the commit? [y/N] " -n 1 -r
        echo
        if $REPLY in ("Y", "y"):
            exit(1)
    git add .
    git commit -m $ARG2
    git push origin master

if $ARG1 == "test":
    print("Starting", colored("EROS", "red"), "tests via", colored("busted", "red"))
    result1 = ![love . selftest].returncode

    print("Starting", colored($(basename $PWD)[:-1], 'red'), "tests via", colored("busted", "red"))
    result2 = ![love . test].returncode

    if result1 * result2:
        exit(1)